# Mikrotik-Tunnel-To-Ubuntu
فعال سازی تانل میکروتیک به اوبونتو با GRE (IPv4 &amp; IPv6)
از همان ابتدای کار فایلی رو ایجاد میکنیم که در داخل آن دستورات قرار گرفته و پس از ذخیره سازی خودکار فایل اجرا میشود و دستورات در سرور مدنظر اعمال خواهد شد و زمانی که سیستم ریستارت میشود هم این فایل دوباره خودکار اجرا و تانل ایجاد میشود.

**1. سرور خارج (اوبونتو)**
- ابتدا با دستور زیر فایل `rc.local` رو ایجاد میکنیم و بهش اجازه دسترسی بعد از هر بار ریستارت شدن سرور رو میدهیم به این صورت بعد از ریستارت شدن سرور دستورات پاک نمیشوند.
```shell
sudo nano /etc/rc.local && sudo chmod +x /etc/rc.local && sudo bash /etc/rc.local
```
متن زیر را در فایل قرار میدیم و فایل رو ذخیره میکنیم و سپس بعد از ذخیره فایل دستورات خودکار اجرا میشوند.
>نکته : (در قسمت `<IPv4-IRAN>` ، آیپی ورژن 4 پابلیک سرور ایران رو قرار میدیم و در بخش `<IPv4-KHAREJ>` ، آیپی ورژن 4 پابلیک خارج رو قرار میدیم)
```shell
#!/bin/bash
sudo ip tunnel add gre1 mode gre remote [IPv4-IRAN] local [IPv4-KHAREJ] ttl 255
sudo ip link set gre1 mtu 1420
sudo ip link set gre1 up
sudo ip addr add 10.10.10.2/30 dev gre1
nohup ping 10.10.10.1 &

exit 0
```
**2. سرور ایران (میکروتیک)**
>نکته : (در این قسمت هم `<IPv4-IRAN>` ، آیپی ورژن 4 پابلیک سرور ایران رو قرار میدیم و در بخش `<IPv4-KHAREJ>` ، آیپی ورژن 4 پابلیک خارج رو قرار میدیم)

```shell
/interface gre add name=gre1 local-address=[IPv4-IRAN] remote-address=[IPv4-KHAREJ] mtu=1420
/ip address add address=10.10.10.1/30 interface=gre1
/ip firewall nat add chain=srcnat action=masquerade
/ip firewall nat add chain=dstnat protocol=tcp dst-port=!8291 action=dst-nat to-addresses=10.10.10.2
```
تا اینجای تانل GRE بین سرور خارج و ایران برقرار شده و در کنار اینترفیس میکروتیک کلمه R (RUN) رو مشاهده میکنید.

 - آیپی v4 داخلی سرور ایران : 10.10.10.1
 - آیپی v4 داخلی سرور خارج : 10.10.10.2

برای اطمینان از اینکه تانل برقرار شده باشه وارد هر دو سرور بشید و از آیپی سرور مقابل پینگ بگیرید.
- به عنوان مثل وارد سرور ایران میشیم و با دستور زیر آیپی v4 داخلی سرور خارج رو روی ایران پینگ میگیرم : 
```shell
ping 10.10.10.2
```
- روی سرور خارچ نیز همین کار رو تکرار میکنیم :
```shell
ping 10.10.10.1
```
